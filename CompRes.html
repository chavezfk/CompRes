<html>
<head>
    <title>Community Computer Sign-In</title>
    <link rel="stylesheet" type="text/css" href="global.css" />
    <script type="text/javascript" src="SigWebTablet.js"></script>
    <script type="text/javascript" src="sheets_setup.js"></script>
    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    
    <script type="text/javascript">
        var sig;
        var authorizeButton = document.getElementById('authorize-button');
        var signoutButton = document.getElementById('signout-button');
        
        window.onload = function()
        {
           var ctx = document.getElementById('sig_canvas').getContext('2d');         
           SetDisplayXSize( 500 );
           SetDisplayYSize( 100 );
           SetTabletState(0, sig);
           SetJustifyMode(0);
           ClearTablet();
           if(sig == null)
           {
              sig = SetTabletState(1, ctx, 50);
           }
           else
           {
              SetTabletState(0, sig);
              sig = null;
              sig = SetTabletState(1, ctx, 50);
           }
        };

        function onClear()
        {
           ClearTablet();
        }
        
        function SaveSig()
        {
            document.getElementById('sig').value = GetSigString(); 
        }
        
        function test()
        {
            listReserves();
            //alert(GetSigString());
        }
        
        function listReserves() {
            gapi.client.sheets.spreadsheets.values.get({
              spreadsheetId: '1QoYsSxvCeSjjlbD8NVcOLXjun-tEHoFaKIG4TxcZkAU',
              range: 'SignIn!A2:C',
            }).then(function(response) {
              var range = response.result;
              if (range.values.length > 0) {
                
                for (i = 0; i < range.values.length; i++) {
                  var row = range.values[i];
                  // Print columns A, B, and C, which correspond to indices 0, 1, and 2.
                  console.log("Name: " + row[0] + "\tDate:" + row[1] + "\tsignature: " + row[2]);
                }
              } else {
                
              }
            }, function(response) {
              appendPre('Error: ' + response.result.error.message);
            });
          }
            /**
           *  Called when the signed in status changes, to update the UI
           *  appropriately. After a sign-in, the API is called.
           */
          function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
              authorizeButton.style.display = 'none';
              signoutButton.style.display = 'block';
              listMajors();
            } else {
              authorizeButton.style.display = 'block';
              signoutButton.style.display = 'none';
            }
          }

          /**
           *  Sign in the user upon button click.
           */
          function handleAuthClick(event) {
            gapi.auth2.getAuthInstance().signIn();
          }

          /**
           *  Sign out the user upon button click.
           */
          function handleSignoutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
          }
    </script>
</head>

<body>
    <form method="post">
    <table>
        <tr>
            <td>
                <label for="first" class="required">First Name:</label>
                <input type="text" name="first" id="first"/>
            </td>
        </tr>
        <tr>
            <td>
                <label for="last" class="required">Last Name:</label>
                <input type="text" name="last" id="last"/>
            </td>
            
        </tr>
        <tr>

            <td >
                <label style="vertical-align:top" for="sig_canvas" class="required">Signature:</label>
                <canvas id="sig_canvas" name="cnv" width="500" height="100"/>
            </td>
        </tr>
    </table>
        
        <input type="button" value="Clear Signature" onclick="javascript:onClear()">
        <input type="button" value="Test" onclick="javascript:test()">
        <input type="submit" value="Submit" onclick="javascrip:SaveSig()">
        
        <input type="text" id="sig" name="sig" style="display: none"></div>
    </form>
    <button id="authorize-button" style="display: none;">Authorize</button>
    <button id="signout-button" style="display: none;">Sign Out</button>
    

</body>

</html>